const destinoss = [
	{
		name: 'Puno',
		tours: [
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			}
		]
	},
	{
		name: 'Cusco',
		tours: [
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			}
		]
	},
	{
		name: 'Bolivia',
		tours: [
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			}
		]
	},
	{
		name: 'Nasca',
		tours: [
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			}
		]
	},
	{
		name: 'Loreto',
		tours: [
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			}
		]
	},
	{
		name: 'Ades',
		tours: [
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			}
		]
	},
	{
		name: 'Lima',
		tours: [
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			}
		]
	},
	{
		name: 'Arequipa',
		tours: [
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			},
			{
				name: 'Tren nocturno de Puno a Cusco Belmond Explorer (2D)',
				desc: 'Visitalo en verano y podras disfrutarlo...',
				id: '01',
				url: 'http://www.google.com'
			}
		]
	}
];
const tickets = [

];

var contador = 0;
var destinosDisponibles = menus.filter((menu) => menu.options);
var destinos = destinosDisponibles.map((destino) => {
	let toursDestino = [];
	destino.options.forEach(grupo => {
		grupo.options.forEach(tour => {
			toursDestino.push({
				name: tour.name ? tour.name.es : null,
				desc: tour.subname ? tour.subname.es : null,
				url: tour.url ? tour.url.es : null,
				id: contador
			});
			contador = contador + 1;
		});
	});

	return {
		name: destino.name.es,
		tours: toursDestino
	}
});

// Form data
var selectedTours = [];
var selectedTickets = [];

// Data for Bus ticket
var starts = [];
var ends = [];

var h = window.innerHeight;
var w = window.innerWidth;
var f = w < 768 ? 2 : 3;

var destinoWasSelected = false;
var destinoIndex = null;

function mostrarDestinos(text) {
	console.log(h);
	console.log(w);
	console.log(f);

	var html = "";

	destinos.forEach((destino, index) => {
		html = html + `
    	<div class="col-xs-6 col-sm-4" id="destino-${index}">
        <a class="bootcards-summary-item" onclick="toogleTours(${index})">
          <i class="fa fa-3x fa-suitcase"></i>
          <h4>${destino.name} <span class="label label-info">${destino.tours.length}</span></h4>
        </a>
      </div>
		`;
	});

	html = html + `
		<div id="space-tours" class="col-xs-12" >
		</div>
	`;

	document.getElementById('destinosCards').innerHTML = html;
}

function toogleTours(index) {
	// Esconder si ya existia seleccionado
	if (destinoWasSelected) {
		document.getElementById(`space-tours`).innerHTML = "";
		document.getElementById(`destino-${destinoIndex}`).setAttribute('class', 'col-xs-6 col-sm-4');
	}
	// Esconder si selecciono lo mismo
	if (index == destinoIndex) {
		destinoWasSelected = false;
		destinoIndex = null;
	}
	// Mostrar tour si seleciono otro
	else {
		destinoWasSelected = true;
		destinoIndex = index;

		var content = `
			<div class="page-header">
				<h3>Tour disponibles de ${destinos[index].name}</h3>
			</div>
			<div>
		`;
		destinos[index].tours.forEach((tour) => {
			content = content + `
				<div>
					<h4><span onclick="addTour(\'${tour.name}\',${tour.id})" style="cursor:pointer">${tour.name}</span> <br> 
						<small>${tour.desc}</small> <br> 
						<small><a href="${tour.url}" target="__blank">Explorar tour >> </a></small> 
					</h4>
				</div>
			`;
		});
		content = content + `
			</div>
		`;
		document.getElementById(`space-tours`).innerHTML = content;
		document.getElementById(`destino-${destinoIndex}`).setAttribute('class', 'col-xs-6 col-sm-4 selecionado');

		// focus
		// document.getElementById(`space-tours`).focus();
	}



	/**
	 * Reservar
	 * http://incalake.com/reservar/email/reservar.php POST application/x-www-form-urlencoded
	 * 
oferta:
nombres:j
pais:q
email:alalala@gmail.com
npax:1
hotel:
nombre_tour[]:Tren nocturno de Puno a Cusco Belmond Explorer (2D)
fecha_excursion[]:10-Aug-2017
id_tour[]:1
url_tour[]:http://incalake.com/tren-puno-cusco
buscador_excursiones:
fecha_otro_tour:
detalle_otro_tour:
origen:0
bus[]:Puno-Arequipa / 06:30AM / Bus turístico con paradas en ruta  / 4M-Express
bfecha[]:15-Aug-2017
detalles:lalalalalala
celular:123456789
	 * 
	 */

}

function addTour(tourName, tourId) {
	selectedTours.push({
		name: tourName,
		id: tourId,
		date: null
	});
	let child = `
			<div class="col-md-12 div-list-tours col-xs-12 " id="detalles-tour-${tourId}">
				<div class="col-md-7 list-tours-name"> ${tourName}
				</div>
				<div class="col-md-3 text-center list-tours-date col-xs-10">
					<div class="input-group">
						<span class="input-group-addon fa fa-calendar">							     
						</span>
						<input class="" id="tour-${tourId}-date" name="date" type="date" onchange="cambiarFechaTour(this)" />
					</div>
				</div>
				<div class="col-md-2 text-center col-xs-2">
					<span class="btn btn-default btn-xs fa fa-close" onclick="removeTour(${tourId})">
					</span>
				</div>
			</div>
		`;
	$('#tours-screen').append(child);

	$('#toursModal').modal('hide');
}

function removeTour(id) {
	selectedTours = selectedTours.filter(tour => tour.id != id);

	var parent = document.getElementById("tours-screen");
	var child = document.getElementById(`detalles-tour-${id}`);
	parent.removeChild(child);
}

function cambiarFechaTour(self) {
	selectedTours.forEach((tour) => {
		if (tour.id == self.id.split('-')[1]) {
			tour.date = self.value
		}
	});
}

/**********************************************************************************************/
/****************************************  BUS TICKET  ****************************************/
/**********************************************************************************************/

function addTicket(name, id) {
	selectedTours.push({
		name: name,
		id: id,
		date: null
	});
	renderSelectedTickets();
}

function removeTicket(id) {
	selectedTours = selectedTours.filter(tour => tour.id != id);
	renderSelectedTickets();
}

function renderSelectedTickets() {
	var items = "";

	selectedTours.forEach((tour) => {
		items = items + `
			<div class="col-md-12 div-list-tours col-xs-12 ">
        <div class="col-md-4">Bus directo local cama 160°</div>
        <div class="col-md-2 text-center col-xs-6">Origen</div>
        <div class="col-md-2 text-center col-xs-6">Destino</div>
        <div class="col-md-3 text-center list-tours-date col-xs-10">
          <div class="input-group">
            <span class="input-group-addon fa fa-calendar">                              
            </span>
            <input class="" id="date" name="date" type="date" />
          </div>
        </div>
        <div class="col-md-1 text-center col-xs-2">
					<span class="btn btn-default btn-xs fa fa-close"></span>
				</div>
      </div>                              
		`;
	});

	document.getElementById('tours-screen').innerHTML = items;
	$('#toursModal').modal('hide');
}

function reservar() {
	var data = {
		name: document.getElementById('name').value,
		nationality: document.getElementById('nationality').value,
		passengers: document.getElementById('numberof').value,
		cellphone: document.getElementById('cellphone').value,
		place: document.getElementById('place').value,
		extra: document.getElementById('extra').value,
		tours: selectedTours,
		tickets: selectedTickets
	}

	console.log(data);
	/*
	$.ajax({
			type : 'POST',
			url : url,
			dataType : 'json',
			data : {username: input_val},
			success : function(user_verification){
					alert("Success");   
			}
	});*/
}

function getStarts() {
	$.ajax({
		url: 'http://incalake.com/reservar/buses.php',
		data: { 'tabla': 'origen' },
		type: 'POST',
		dataType: 'Json',
		success: function (res) {
			$('#origen').html(res.html);
		}
	});

}

function getEnds(origen) {
	if (origen == 0) {
		$('#destino').html('<option value="0">Ciudad de Destino</option>').attr('disabled', true);
	}
	else {
		$.ajax({
			url: 'http://incalake.com/reservar/buses.php',
			data: { 'tabla': 'destino', 'origen': origen },
			type: 'POST',
			dataType: 'Json',
			success: function (res) {
				$('#destino').html(res.html).attr('disabled', false);
			}
		});
	}
}

function buscar_bus() {
	console.log($('.select'));


	$.ajax({
		url: 'http://incalake.com/reservar/buses.php',
		data: { 'tabla': 'busqueda', 'origen': $('#origen').val(), 'destino': $('#destino').val() },
		type: 'POST',
		dataType: 'json',
		success: function (res) {
			console.log(res);
			$('#div_busqueda').html('').append(`
				<span class=""></span>
        <span>Resultados de <b>Origen:</b>
					<label class="label label-primary" style="font-size:14px;"> 
						${$('#origen option:selected').html()}
					</label>
          <b>Destino:</b>
					<label class="label label-primary" style="font-size:14px;"> 
						${$('#destino option:selected').html()}
					</label>
        </span>
        <br>
				<span>
          Seleccione un BUS de nuestro listado
				</span>
			`).append(res.html);

			$('.select').click(function () {
				console.log('ioio');
				console.log($(this).data('id'));
				$(this).children('td').each(function (index) {
					switch(index){
						case 0: campo1 = $(this).text();
							break;
					}
					console.log($(this).text())
				});
			});

		}
	});
	console.log($('.select').html());
};




